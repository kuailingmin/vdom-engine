/*!
 * vdom-engine.js v0.1.6
 * (c) 2016 Jade Gu
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("path-to-regexp"),require("querystring")):"function"==typeof define&&define.amd?define(["path-to-regexp","querystring"],n):e.Vengine=n(e.pathToRegexp,e.querystring)}(this,function(e,n){"use strict";function t(e,n){me[e]=n}function r(e){delete me[e]}function o(e){var n=e.match(ge);return n?(xe=n[2],me[n[1]]):void 0}function a(e,n,t){var r=o(n);r&&r.attach(e,xe,t)}function c(e,n){var t=o(n);t&&t.detach(e,xe)}function u(e,n){for(var t in n)"children"!==t&&null!=n[t]&&a(e,t,n[t])}function l(e,n,t){for(var r in n)if("children"!==r){var o=t[r];o!==n[r]&&(null==o?c(e,r):a(e,r,o))}for(var r in t)"children"!==r&&(r in n||a(e,r,t[r]))}function d(e){return"function"==typeof e}function f(e){return null!=e&&d(e)}function v(){}function p(e){return e}function s(e,n){return function(){return e.apply(this,arguments),n.apply(this,arguments)}}function h(e,n,t){for(var r=e.length,o=-1;r--;){var a=e[++o];Re(a)?h(a,n,t):n(a,t)}}function y(e,n){e[e.length]=n}function m(e,n){if(!n)return e;for(var t=Object.keys(n),r=t.length;r--;)e[t[r]]=n[t[r]];return e}function g(){return++je}function x(e,n){return e+n.charAt(0).toUpperCase()+n.substring(1)}function b(e,n){var t=e.type,r=e.props,o=t(r,n);if(o&&o.render&&(o=o.render()),null===o||o===!1)o={vtype:VCOMMENT,uid:_.getUid()};else if(!o||!o.vtype)throw new Error("@"+t.name+"#render:You may have returned undefined, an array or some other invalid object");return o}function k(e,n){var t={},r=null;if(null!=n)for(var o in n)"key"===o?void 0!==n.key&&(r=""+n.key):t[o]=n[o];var a=e.defaultProps;if(a)for(var o in a)void 0===t[o]&&(t[o]=a[o]);var i=arguments.length,c=Ae;if(i>2){c=[];for(var u=2;i>u;u++){var l=arguments[u];Re(l)?h(l,E,c):E(l,c)}}t.children=c;var d=null;if("string"==typeof e)d=we;else{if("function"!=typeof e)throw new Error("unexpect type [ "+e+" ]");d=Ne}var f={vtype:d,type:e,props:t,key:r};return d===Ne&&(f.uid=g()),f}function w(e){return null!=e&&!!e.vtype}function N(e){var n=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];return k.apply(void 0,[e].concat(t))};return n.type=e,n}function E(e,n){null!=e&&"boolean"!=typeof e&&(n[n.length]=e.vtype?e:""+e)}function C(e,n,t){e[n]=t}function O(e,n){e[n]=""}function U(e,n,t){e.setAttribute(n,t+"")}function I(e,n){e.removeAttribute(n)}function S(e,n,t){A(e.style,n,t)}function T(e,n){e.style[n]=""}function A(e,n,t){!_.isUnitlessNumber[n]&&_.RE_NUMBER.test(t)?t+="px":null!=t&&"boolean"!=typeof t||(t=""),"float"===n&&(n="cssFloat"),e[n]=t}function R(e,n){e.eventStore=null;for(var t in n)0===t.indexOf("on-")&&(t=j(t),De[t]&&(e[t]=null))}function j(e){return e.replace(/^on-/,"on").toLowerCase()}function M(e,n,t){if(n="on"+n,1===De[n])return void(e[n]=t);var r=e.eventStore||(e.eventStore={});r[n]=t,Ge[n]||(document.addEventListener(n.substr(2),B,!1),Ge[n]=!0),We&&n===_e&&e.addEventListener("click",$e,!1);var o=e.nodeName;"onchange"!==n||"INPUT"!==o&&"TEXTAREA"!==o||M(e,"oninput",t)}function V(e,n){if(n="on"+n,1===De[n])return void(e[n]=null);var t=e.eventStore||(e.eventStore={});delete t[n],We&&n===_e&&e.removeEventListener("click",$e,!1);var r=e.nodeName;"onchange"!==n||"INPUT"!==r&&"TEXTAREA"!==r||delete t.oninput}function B(e){for(var n=e.target,t=e.type,r="on"+t,o=null;n;){var a=n,i=a.eventStore,c=i&&i[r];if(c){if(o||(o=P(e)),o.currentTarget=n,c.call(n,o),o.$cancalBubble)break;n=n.parentNode}else n=n.parentNode}}function P(e){var n={},t=function(){return n.$cancalBubble=!0};n.nativeEvent=e,n.persist=v;for(var r in e)"function"!=typeof e[r]?n[r]=e[r]:"stopPropagation"===r||"stopImmediatePropagation"===r?n[r]=t:n[r]=e[r].bind(e);return n}function q(e,n,t){var r=e.vtype,o=null;return r?r===we?o=G(e,n,t):r===Ne?o=K(e,n,t):r===Ee&&(o=document.createComment("react-empty: "+e.uid)):o=document.createTextNode(e),o}function z(e,n,t,r){var o=e.vtype;return o===Ne?Q(e,n,t,r):o!==we?t:(null!=e.props[Ce]?(Y(e,n,t,r),H(n,t,r)):(L(e,n,t,r),Y(e,n,t,r)),t)}function L(e,n,t,r){var o={removes:[],updates:[],creates:[]};X(o,e,n,t,r),h(o.removes,F),h(o.updates,D),h(o.creates,W)}function D(e){if(e){var n=e.node;if(e.shouldUpdate){var t=e.vnode,r=e.newVnode,o=e.context;t.vtype?t.vtype===we?Y(t,r,n,o):t.vtype===Ne&&(n=Q(t,r,n,o)):n.nodeValue=r}if(e.index!==e.fromIndex){var a=n.parentNode.childNodes[index];a!==n&&n.parentNode.insertBefore(n,a)}}}function F(e){$(e.vnode,e.node),e.node.parentNode.removeChild(e.node)}function W(e){var n=e.parentNode,t=n.childNodes[e.index],r=q(e.vnode,e.context,n.namespaceURI);n.insertBefore(r,t)}function $(e,n){var t=e.vtype;t===we?J(e,n):t===Ne&&Z(e,n)}function G(e,n,t){var r=e.type,o=e.props,a=null;return"svg"===r||t===be?(a=document.createElementNS(be,r),t=be):a=document.createElement(r),H(a,o.children,n),u(a,o),o[Oe]&&o[Oe].call(null,a,o),o[Ue]&&y(He,{type:Ue,node:a,props:o}),a}function H(e,n,t){for(var r=e.namespaceURI,o=0,a=n.length;a>o;o++)e.appendChild(q(n[o],t,r))}function X(e,n,t,r,o){var a=r.childNodes,i=n.props.children,c=t.props.children,u=i.length,l=c.length;if(0!==u)if(0!==l){for(var d={},f=Array(l),v=null,p=null,s=0;u>s;s++)for(var h=i[s],m=0;l>m;m++)if(!f[m]){var g=c[m];if(h===g){var x=!1;o&&h.vtype===Ne&&h.type.length>1&&(x=!0),f[m]={shouldUpdate:x,vnode:h,newVnode:g,node:a[s],context:o,index:m,fromIndex:s},d[s]=!0;break}}for(var s=0;u>s;s++)if(!d[s]){for(var b=i[s],k=!0,m=0;l>m;m++)if(!f[m]){var w=c[m];if(w.type===b.type&&w.key===b.key){f[m]={shouldUpdate:!0,vnode:b,newVnode:w,node:a[s],context:o,index:m,fromIndex:s},k=!1;break}}k&&(v||(v=[]),y(v,{vnode:b,node:a[s]}))}for(var s=0;l>s;s++){var N=f[s];N?N.vnode.vtype===we&&X(e,N.vnode,N.newVnode,N.node,N.context):(p||(p=[]),y(p,{vnode:c[s],parentNode:r,context:o,index:s}))}v&&y(e.removes,v),p&&y(e.creates,p),y(e.updates,f)}else for(var s=0;u>s;s++)y(e.removes,{vnode:i[s],node:a[s]});else{if(0===l)return;for(var s=0;l>s;s++)y(e.creates,{vnode:c[s],parentNode:r,context:o,index:s})}}function Y(e,n,t){var r=n.props;return r[Ie]&&r[Ie].call(null,t,r),l(t,e.props,r),r[Se]&&r[Se].call(null,t,r),t}function J(e,n){for(var t=e.props,r=t.children,o=n.childNodes,a=0,i=r.length;i>a;a++)$(r[a],o[a]);d(t[Te])&&t[Te].call(null,n,t),R(n,t)}function K(e,n,t){var r=b(e,n),o=q(r,n,t);return o.cache=o.cache||{},o.cache[e.uid]=r,o}function Q(e,n,t,r){var o=e.uid,a=t.cache[o];delete t.cache[o];var i=b(n,r),c=ee(a,i,t,r);return c.cache=c.cache||{},c.cache[n.uid]=i,c!==t&&m(c.cache,t.cache),c}function Z(e,n){var t=e.uid,r=n.cache[t];delete n.cache[t],$(r,n)}function ee(e,n,t,r){var o=t;return null==n?($(e,t),t.parentNode.removeChild(t)):e.type!==n.type||e.key!==n.key?($(e,t),o=q(n,r,t.namespaceURI),t.parentNode.replaceChild(o,t)):(e!==n||r)&&(o=z(e,n,t,r)),o}function ne(e,n,r,o){if(!e.vtype)throw new Error("cannot render "+e+" to container");t("attr",ze),t("prop",qe),t("on",Fe),t("css",Le);var a=n[ke]||(n[ke]=g()),i=Ye[a];if(d(r)&&(o=r,r=void 0),i)return void(i===!0?Ye[a]={vnode:e,context:r,callback:o}:(i.vnode=e,i.context=r,o&&(i.callback=i.callback?s(i.callback,o):o)));if(Ye[a]=!0,Je.hasOwnProperty(a))ee(Je[a],e,n.firstChild,r);else{for(var c=q(e,r,n.namespaceURI),u=null;u=n.lastChild;)n.removeChild(u);n.appendChild(c)}Je[a]=e,Xe(),i=Ye[a],Ye[a]=null,"object"==typeof i&&ne(i.vnode,n,i.context,i.callback),o&&o()}function te(e){if(!e.nodeName)throw new Error("expect node");var n=e[ke],t=null;return(t=Je[n])?($(t,e.firstChild),e.removeChild(e.firstChild),delete Je[n],delete Ye[n],!0):!1}function re(e,n,t){y(e.attrs,n+'="'+t+'"')}function oe(e,n,t){!Me[styleName]&&Be.test(t)?t+="px":null!=t&&"boolean"!=typeof t||(t=""),t&&y(e.style,n+":"+t+";")}function ae(e,n){return t("attr",Qe),t("css",Ze),ie(e,n)}function ie(e,n){var t=e.vtype,r="";return t?t===we?r=ce(e,n):t===Ne&&(r=de(e,n)):r=e,r}function ce(e,n){var t={tagName:e.type,children:e.props.children,attrs:[],style:[]};return u(t,e.props),ue(t)}function ue(e,n){var t=e.tagName,r=(e.attrs,e.style,e.children),o=fe(e),a=en[t];return a?"<"+t+o+" />":"<"+t+o+">"+le(r,n)+"</"+t+">"}function le(e,n){for(var t=[],r=0,o=e.length;o>r;r++)y(t,ie(e[r],n));return t.join("")}function de(e,n){var t=b(e,n),r=ie(t,n);return r}function fe(e){var n=e.attrs,t=e.style;return t.length&&y(n,'style="'+t.join("")+'"'),n.length?" "+n.join(" "):""}function ve(n,t,r){var o=[],a=e(n,o),i=a.exec(t);if(!i)return!1;for(var c=1,u=i.length;u>c;c++){var l=o[c-1];l&&("string"==typeof i[c]?r[l.name]=decodeURIComponent(i[c]):r[l.name]=i[c])}return!0}function pe(e){return"?"===e[0]?e.substr(1):e}function se(e){return e.replace(/\/\//g,"/")}function he(e,n){function t(e){var n=p.indexOf(e);return-1===n&&p.push(e),function(){var n=p.indexOf(e);-1!==n&&p.splice(i,1)}}function r(){return v}function o(e,n){return v=e,n||p.forEach(ye),v}function a(e,n){var t=l[e];if(!d(t))throw new Error("Expected "+e+" in setter to be a function which is "+t);var r=t(t,n);return f(r)?r.then(o):(v!==r&&o(r),v)}function c(e,n){var t=u(e);if(!d(t))throw new Error("Expected "+e+" in setter to be a function which is "+t);var r=t(v,n);return r}var u=e.getter,l=e.setter,v=n,p=[],s={getState:r,replaceState:o,setBy:a,getBy:c,subscribe:t};return s}function ye(e){return e()}e="default"in e?e["default"]:e,n="default"in n?n["default"]:n;var me={},ge=/^([^-]+)-(.+)$/,xe=null,be="http://www.w3.org/2000/svg",ke="liteid",we=1,Ne=2,Ee=3,Ce="prop-innerHTML",Oe="hook-willMount",Ue="hook-didMount",Ie="hook-willUpdate",Se="hook-didUpdate",Te="hook-willUnmount",Ae=[],Re=Array.isArray,je=0,Me={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridColumn:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Ve=["Webkit","ms","Moz","O"];Object.keys(Me).forEach(function(e){Ve.forEach(function(n){Me[x(n,e)]=1})});var Be=/^-?\d+(\.\d+)?$/;Object.freeze||(Object.freeze=p);var Pe={h:k,createElement:k,createFactory:N,isValidElement:w,addDirective:t,removeDirective:r},qe={attach:C,detach:O},ze={attach:U,detach:I},Le={attach:S,detach:T},De={onmouseleave:1,onmouseenter:1,onload:1,onunload:1,onscroll:1,onfocus:1,onblur:1,onrowexit:1,onbeforeunload:1,onstop:1,ondragdrop:1,ondragenter:1,ondragexit:1,ondraggesture:1,ondragover:1,oncontextmenu:1},Fe={attach:M,detach:V},We="ontouchstart"in document,$e=function(){},_e="onclick",Ge={},He=[],Xe=function(){var e=He.length;if(e){for(var n=He,t=-1;e--;){var r=n[++t];r.props[r.type].call(null,r.node,r.props)}He.length=0}},Ye={},Je={},Ke={render:ne,destroy:te},Qe={attach:re},Ze={attach:oe},en={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},nn={renderToString:ae},tn=function(e){return function(t,r){var o=m({},t),a=se(o.pathname),i=pe(o.search),c=o.params={};o.query=n.parse(i);for(var u in e){var l=ve(u,a,c),f=e[u];if(l&&d(f)){f(c,r);break}}return o}},rn={createMatcher:tn},on={createStore:he},an={};return m(an,Pe),m(an,Ke),m(an,nn),m(an,rn),m(an,on),an});