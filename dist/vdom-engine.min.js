/*!
 * vdom-engine.js v0.1.6
 * (c) 2016 Jade Gu
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("path-to-regexp"),require("querystring")):"function"==typeof define&&define.amd?define(["path-to-regexp","querystring"],n):e.Vengine=n(e.pathToRegexp,e.querystring)}(this,function(e,n){"use strict";function t(e,n){ge[e]=n}function r(e){delete ge[e]}function o(e){var n=e.match(be);return n?(xe=n[2],ge[n[1]]):void 0}function a(e,n,t){var r=o(n);r&&r.attach(e,xe,t)}function c(e,n){var t=o(n);t&&t.detach(e,xe)}function u(e,n){for(var t in n)"children"!==t&&null!=n[t]&&a(e,t,n[t])}function l(e,n,t){for(var r in n)if("children"!==r){var o=t[r];o!==n[r]&&(null==o?c(e,r):a(e,r,o))}for(var r in t)"children"!==r&&(r in n||a(e,r,t[r]))}function f(e){return"function"==typeof e}function d(e){return null!=e&&f(e.then)}function s(e){return e()}function p(){}function v(e){return e}function h(e,n){return function(){return e.apply(this,arguments),n.apply(this,arguments)}}function y(e,n,t){for(var r=e.length,o=-1;r--;){var a=e[++o];Re(a)?y(a,n,t):n(a,t)}}function m(e,n){e[e.length]=n}function g(e,n){if(!n)return e;for(var t=Object.keys(n),r=t.length;r--;)e[t[r]]=n[t[r]];return e}function b(){return++Me}function x(e,n){return e+n.charAt(0).toUpperCase()+n.substring(1)}function k(e,n){var t=e.type,r=e.props,o=t(r,n);if(o&&o.render&&(o=o.render()),null===o||o===!1)o={vtype:VCOMMENT,uid:_.getUid()};else if(!o||!o.vtype)throw new Error("@"+t.name+"#render:You may have returned undefined, an array or some other invalid object");return o}function w(e,n){var t={},r=null;if(null!=n)for(var o in n)"key"===o?void 0!==n.key&&(r=""+n.key):t[o]=n[o];var a=e.defaultProps;if(a)for(var o in a)void 0===t[o]&&(t[o]=a[o]);var i=arguments.length,c=je;if(i>2){c=[];for(var u=2;i>u;u++){var l=arguments[u];Re(l)?y(l,C,c):C(l,c)}}t.children=c;var f=null;if("string"==typeof e)f=Ee;else{if("function"!=typeof e)throw new Error("unexpect type [ "+e+" ]");f=Ne}var d={vtype:f,type:e,props:t,key:r};return f===Ne&&(d.uid=b()),d}function E(e){return null!=e&&!!e.vtype}function N(e){var n=function(){for(var n=arguments.length,t=Array(n),r=0;n>r;r++)t[r]=arguments[r];return w.apply(void 0,[e].concat(t))};return n.type=e,n}function C(e,n){null!=e&&"boolean"!=typeof e&&(n[n.length]=e.vtype?e:""+e)}function O(e,n,t){e[n]=t}function U(e,n){e[n]=""}function I(e,n,t){e.setAttribute(n,t+"")}function S(e,n){e.removeAttribute(n)}function A(e,n,t){j(e.style,n,t)}function T(e,n){e.style[n]=""}function j(e,n,t){!_.isUnitlessNumber[n]&&_.RE_NUMBER.test(t)?t+="px":null!=t&&"boolean"!=typeof t||(t=""),"float"===n&&(n="cssFloat"),e[n]=t}function R(e,n){e.eventStore=null;for(var t in n)0===t.indexOf("on-")&&(t=M(t),Le[t]&&(e[t]=null))}function M(e){return e.replace(/^on-/,"on").toLowerCase()}function V(e,n,t){if(n="on"+n,1===Le[n])return void(e[n]=t);var r=e.eventStore||(e.eventStore={});r[n]=t,He[n]||(document.addEventListener(n.substr(2),F,!1),He[n]=!0),$e&&n===Ge&&e.addEventListener("click",_e,!1);var o=e.nodeName;"onchange"!==n||"INPUT"!==o&&"TEXTAREA"!==o||V(e,"oninput",t)}function q(e,n){if(n="on"+n,1===Le[n])return void(e[n]=null);var t=e.eventStore||(e.eventStore={});delete t[n],$e&&n===Ge&&e.removeEventListener("click",_e,!1);var r=e.nodeName;"onchange"!==n||"INPUT"!==r&&"TEXTAREA"!==r||delete t.oninput}function F(e){for(var n=e.target,t=e.type,r="on"+t,o=null;n;){var a=n,i=a.eventStore,c=i&&i[r];if(c){if(o||(o=P(e)),o.currentTarget=n,c.call(n,o),o.$cancalBubble)break;n=n.parentNode}else n=n.parentNode}}function P(e){var n={},t=function(){return n.$cancalBubble=!0};n.nativeEvent=e,n.persist=p;for(var r in e)"function"!=typeof e[r]?n[r]=e[r]:"stopPropagation"===r||"stopImmediatePropagation"===r?n[r]=t:n[r]=e[r].bind(e);return n}function z(e,n,t){var r=e.vtype,o=null;return r?r===Ee?o=H(e,n,t):r===Ne?o=Q(e,n,t):r===Ce&&(o=document.createComment("react-empty: "+e.uid)):o=document.createTextNode(e),o}function D(e,n,t,r){var o=e.vtype;return o===Ne?Z(e,n,t,r):o!==Ee?t:(null!=e.props[Oe]?(J(e,n,t,r),X(n,t,r)):(B(e,n,t,r),J(e,n,t,r)),t)}function B(e,n,t,r){var o={removes:[],updates:[],creates:[]};Y(o,e,n,t,r),y(o.removes,W),y(o.updates,L),y(o.creates,$)}function L(e){if(e){var n=e.node;if(e.shouldUpdate){var t=e.vnode,r=e.newVnode,o=e.context;t.vtype?t.vtype===Ee?J(t,r,n,o):t.vtype===Ne&&(n=Z(t,r,n,o)):n.nodeValue=r}if(e.index!==e.fromIndex){var a=n.parentNode.childNodes[index];a!==n&&n.parentNode.insertBefore(n,a)}}}function W(e){G(e.vnode,e.node),e.node.parentNode.removeChild(e.node)}function $(e){var n=e.parentNode,t=n.childNodes[e.index],r=z(e.vnode,e.context,n.namespaceURI);n.insertBefore(r,t)}function G(e,n){var t=e.vtype;t===Ee?K(e,n):t===Ne&&ee(e,n)}function H(e,n,t){var r=e.type,o=e.props,a=null;return"svg"===r||t===ke?(a=document.createElementNS(ke,r),t=ke):a=document.createElement(r),X(a,o.children,n),u(a,o),o[Ue]&&o[Ue].call(null,a,o),o[Ie]&&m(Xe,{type:Ie,node:a,props:o}),a}function X(e,n,t){for(var r=e.namespaceURI,o=0,a=n.length;a>o;o++)e.appendChild(z(n[o],t,r))}function Y(e,n,t,r,o){var a=r.childNodes,i=n.props.children,c=t.props.children,u=i.length,l=c.length;if(0!==u)if(0!==l){for(var f={},d=Array(l),s=null,p=null,v=0;u>v;v++)for(var h=i[v],y=0;l>y;y++)if(!d[y]){var g=c[y];if(h===g){var b=!1;o&&h.vtype===Ne&&h.type.length>1&&(b=!0),d[y]={shouldUpdate:b,vnode:h,newVnode:g,node:a[v],context:o,index:y,fromIndex:v},f[v]=!0;break}}for(var v=0;u>v;v++)if(!f[v]){for(var x=i[v],k=!0,y=0;l>y;y++)if(!d[y]){var w=c[y];if(w.type===x.type&&w.key===x.key){d[y]={shouldUpdate:!0,vnode:x,newVnode:w,node:a[v],context:o,index:y,fromIndex:v},k=!1;break}}k&&(s||(s=[]),m(s,{vnode:x,node:a[v]}))}for(var v=0;l>v;v++){var E=d[v];E?E.vnode.vtype===Ee&&Y(e,E.vnode,E.newVnode,E.node,E.context):(p||(p=[]),m(p,{vnode:c[v],parentNode:r,context:o,index:v}))}s&&m(e.removes,s),p&&m(e.creates,p),m(e.updates,d)}else for(var v=0;u>v;v++)m(e.removes,{vnode:i[v],node:a[v]});else{if(0===l)return;for(var v=0;l>v;v++)m(e.creates,{vnode:c[v],parentNode:r,context:o,index:v})}}function J(e,n,t){var r=n.props;return r[Se]&&r[Se].call(null,t,r),l(t,e.props,r),r[Ae]&&r[Ae].call(null,t,r),t}function K(e,n){for(var t=e.props,r=t.children,o=n.childNodes,a=0,i=r.length;i>a;a++)G(r[a],o[a]);f(t[Te])&&t[Te].call(null,n,t),R(n,t)}function Q(e,n,t){var r=k(e,n),o=z(r,n,t);return o.cache=o.cache||{},o.cache[e.uid]=r,o}function Z(e,n,t,r){var o=e.uid,a=t.cache[o];delete t.cache[o];var i=k(n,r),c=ne(a,i,t,r);return c.cache=c.cache||{},c.cache[n.uid]=i,c!==t&&g(c.cache,t.cache),c}function ee(e,n){var t=e.uid,r=n.cache[t];delete n.cache[t],G(r,n)}function ne(e,n,t,r){var o=t;return null==n?(G(e,t),t.parentNode.removeChild(t)):e.type!==n.type||e.key!==n.key?(G(e,t),o=z(n,r,t.namespaceURI),t.parentNode.replaceChild(o,t)):(e!==n||r)&&(o=D(e,n,t,r)),o}function te(e,n,r,o){if(!e.vtype)throw new Error("cannot render "+e+" to container");t("attr",De),t("prop",ze),t("on",We),t("css",Be);var a=n[we]||(n[we]=b()),i=Je[a];if(f(r)&&(o=r,r=void 0),i)return void(i===!0?Je[a]={vnode:e,context:r,callback:o}:(i.vnode=e,i.context=r,o&&(i.callback=i.callback?h(i.callback,o):o)));if(Je[a]=!0,Ke.hasOwnProperty(a))ne(Ke[a],e,n.firstChild,r);else{for(var c=z(e,r,n.namespaceURI),u=null;u=n.lastChild;)n.removeChild(u);n.appendChild(c)}Ke[a]=e,Ye(),i=Je[a],Je[a]=null,"object"==typeof i&&te(i.vnode,n,i.context,i.callback),o&&o()}function re(e){if(!e.nodeName)throw new Error("expect node");var n=e[we],t=null;return(t=Ke[n])?(G(t,e.firstChild),e.removeChild(e.firstChild),delete Ke[n],delete Je[n],!0):!1}function oe(e,n,t){m(e.attrs,n+'="'+t+'"')}function ae(e,n,t){!Ve[styleName]&&Fe.test(t)?t+="px":null!=t&&"boolean"!=typeof t||(t=""),t&&m(e.style,n+":"+t+";")}function ie(e,n){return t("attr",Ze),t("css",en),ce(e,n)}function ce(e,n){var t=e.vtype,r="";return t?t===Ee?r=ue(e,n):t===Ne&&(r=de(e,n)):r=e,r}function ue(e,n){var t={tagName:e.type,children:e.props.children,attrs:[],style:[]};return u(t,e.props),le(t)}function le(e,n){var t=e.tagName,r=(e.attrs,e.style,e.children),o=se(e),a=nn[t];return a?"<"+t+o+" />":"<"+t+o+">"+fe(r,n)+"</"+t+">"}function fe(e,n){for(var t=[],r=0,o=e.length;o>r;r++)m(t,ce(e[r],n));return t.join("")}function de(e,n){var t=k(e,n),r=ce(t,n);return r}function se(e){var n=e.attrs,t=e.style;return t.length&&m(n,'style="'+t.join("")+'"'),n.length?" "+n.join(" "):""}function pe(n,t,r){var o=[],a=e(n,o),i=a.exec(t);if(!i)return!1;for(var c=1,u=i.length;u>c;c++){var l=o[c-1];l&&("string"==typeof i[c]?r[l.name]=decodeURIComponent(i[c]):r[l.name]=i[c])}return!0}function ve(e){return"?"===e[0]?e.substr(1):e}function he(e){return e.replace(/\/\//g,"/")}function ye(e){function n(e){a[e]=un()}function t(e,n,t,r){var i=new Date,c=i.getHours()+":"+cn(i.getMinutes())+":"+cn(i.getSeconds()),u=(un()-a[e]).toFixed(2),l=o+"-"+(t===r?"equal":"diff")+": action ["+e+"] end at "+c+", take "+u+"ms";try{console.groupCollapsed(l)}catch(f){try{console.group(l)}catch(f){console.log(l)}}if("log"===an)console[an](n),console[an](t),console[an](r);else{var d=r instanceof Error;console[an]("%c data","color: #03A9F4; font-weight: bold",n),console[an]("%c prev state","color: #9E9E9E; font-weight: bold",t),console[an]("%c "+(d?"error":"next state"),"color: #4CAF50; font-weight: bold",r)}try{console.groupEnd()}catch(f){console.log("-- log end --")}}var r=e.name,o=void 0===r?"store":r,a={};return{start:n,end:t}}function me(e,n){function t(e){var n=m.indexOf(e);return-1===n&&m.push(e),function(){var n=m.indexOf(e);-1!==n&&m.splice(i,1)}}function r(){return y}function o(e,n){return y=e,n||m.forEach(s),y}function a(e,n){var t=l[e];if(!f(t))throw new Error("Expected a function which is "+t);var r=t(y,n);return d(r)?r.then(o):(y!==r&&o(r),y)}function c(e,n){var t=u(e);if(!f(t))throw new Error("Expected a function which is "+t);var r=t(y,n);return r}var u=e.getter,l=e.setter,p=e.name,v=e.debug,h=null;v!==!1&&(h=ye(p));var y=n,m=[],g={logger:h,setter:l,getter:u,getState:r,replaceState:o,search:c,dispatch:a,subscribe:t};return l&&(g.actions=Object.keys(l).reduce(function(e,n){return e[n]=function(e){h&&h.start(n);var t=y,r=y,o=function(r){h&&h.end(n,e,t,r)};try{r=a(n,e)}catch(i){return o(i),r}return d(r)?r.then(o,o):(o(r),r)},e},{})),u&&(g.selectors=Object.keys(u).reduce(function(e,n){return e[n]=c.bind(null,n),e})),g}e="default"in e?e["default"]:e,n="default"in n?n["default"]:n;var ge={},be=/^([^-]+)-(.+)$/,xe=null,ke="http://www.w3.org/2000/svg",we="liteid",Ee=1,Ne=2,Ce=3,Oe="prop-innerHTML",Ue="hook-willMount",Ie="hook-didMount",Se="hook-willUpdate",Ae="hook-didUpdate",Te="hook-willUnmount",je=[],Re=Array.isArray,Me=0,Ve={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridColumn:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},qe=["Webkit","ms","Moz","O"];Object.keys(Ve).forEach(function(e){qe.forEach(function(n){Ve[x(n,e)]=1})});var Fe=/^-?\d+(\.\d+)?$/;Object.freeze||(Object.freeze=v);var Pe={h:w,createElement:w,createFactory:N,isValidElement:E,addDirective:t,removeDirective:r},ze={attach:O,detach:U},De={attach:I,detach:S},Be={attach:A,detach:T},Le={onmouseleave:1,onmouseenter:1,onload:1,onunload:1,onscroll:1,onfocus:1,onblur:1,onrowexit:1,onbeforeunload:1,onstop:1,ondragdrop:1,ondragenter:1,ondragexit:1,ondraggesture:1,ondragover:1,oncontextmenu:1},We={attach:V,detach:q},$e="ontouchstart"in document,_e=function(){},Ge="onclick",He={},Xe=[],Ye=function(){var e=Xe.length;if(e){for(var n=Xe,t=-1;e--;){var r=n[++t];r.props[r.type].call(null,r.node,r.props)}Xe.length=0}},Je={},Ke={},Qe={render:te,destroy:re},Ze={attach:oe},en={attach:ae},nn={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},tn={renderToString:ie},rn=function(e){return function(t,r){var o=g({},t),a=he(o.pathname),i=ve(o.search),c=o.params={};o.query=n.parse(i);for(var u in e){var l=pe(u,a,c),d=e[u];if(l&&f(d)){d(c,r);break}}return o}},on={createMatcher:rn},an="info"in console?"info":"log",cn=function(e){return("0"+e).slice(-2)},un="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return(new Date).getTime()},ln={createStore:me},fn={};return g(fn,Pe),g(fn,Qe),g(fn,tn),g(fn,on),g(fn,ln),fn});